<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SiJe Tests</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="loop-settings">
        <section>Looped mode :
            <div class="switch">
                <input type="checkbox" checked />
                <div class="switch-button on"></div>
            </div>
        </section>
        <section>
            <button class="reset">Reset looped function</button>
        </section>
        <section id="range">
            <input class="text-button" type="number" value="100" />
            <input class="range-button" type="range" />
        </section>
    </div>
    <section id="monitoring">
        <p>Information</p>
        <section>
            <p>Loop: <span id="loop-state">ON</span></p>
            <p>Number of reset: <span id="number-reset">0</span></p>
            <p>Current looped function: <span id="looped-function"></span></p>
            <p>Frame per second: <span id="fps">0</span> </p>
        </section>
    </section>
    <canvas id="canvas"></canvas>
    <button class="erase">Erase canvas</button>
    <div id="button-container">
        <button>Counter</button>
        <button>Test2</button>
    </div>
</body>
<script type="text/javascript">
    //Functions' objects
    String.prototype.upperCaseFrstLetr = function(){
        return this.charAt(0).toUpperCase() + this.slice(1);
    };

    var fps = 100;
    var functions = {
        counter: {
            name: "counter",
            poulet: 0,
            update: function () {
                this.poulet++;
                context.fillText(this.poulet, canvas.width / 2, canvas.height / 2);
            },
            reset: function () {
                this.poulet = 0;
            }
        },
        poulet:{name: 'poulet'}
    };
    for(prop in functions){
        var button = document.createElement('button');
        button.textContent = functions[prop].name.upperCaseFrstLetr();
        document.getElementById('button-container').appendChild(button);
        var fun = functions['counter'];
        button.addEventListener('click', function(){
            currFunct = functions.counter;
            console.log(currFunct);
        });
    }

    var monitor ={
        currTime: 0,
        arrTime: [],
        sumTime: 0,
        getTime: function(){
            this.sumTime = 0;
            if(this.currTime != 0) {
                if(this.arrTime.length >= 10)
                    this.arrTime.shift();
                this.arrTime.push(Math.ceil(1000/((new Date()).getTime() - this.currTime)));
                for(var i = 0; i < this.arrTime.length; i++){
                    this.sumTime += this.arrTime[i];
                }
                this.currTime = (new Date()).getTime();
                return (this.sumTime / i);
            }
            else {
                this.currTime = (new Date()).getTime();
                return 0;
            }
        }
    };

    var checkBox = document.getElementsByTagName('input')[0];
    var eraseBtn = document.getElementsByClassName('erase')[0];
    var resetBtn = document.getElementsByClassName('reset')[0];
    var rangeBtn = document.getElementsByClassName('range-button')[0];
    var textBtn = document.getElementsByClassName('text-button')[0];
    var spanLoopState = document.getElementById('loop-state');
    var spanNbrReset = document.getElementById('number-reset');
    var spanLoopedFunction = document.getElementById('looped-function');
    var spanFPS = document.getElementById('fps');

    var currFunct = null;

    //spanLoopedFunction.textContent = currFunct.name + "()";
    rangeBtn.value = fps;

    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');

    eraseBtn.addEventListener('click', function(){
        context.clearRect(0, 0, canvas.width, canvas.height);
    });
    resetBtn.addEventListener('click', function(){
        currFunct.reset();
        spanNbrReset.textContent = parseInt(spanNbrReset.textContent) + 1;
    });
    rangeBtn.addEventListener('input', function(){
        fps = this.value;
        textBtn.value= this.value;


    });
    textBtn.addEventListener('input', function(){
        rangeBtn.value = this.value;
        fps = this.value;
    });
    var intervalFunction = function(){
        console.log('poulet');
        if(checkBox.checked){
            spanFPS.textContent = monitor.getTime();
            spanLoopState.textContent = "ON";
            context.clearRect(0, 0, canvas.width, canvas.height);
            if(currFunct.update)
                currFunct.update();
        }
        else
            spanLoopState.textContent = "OFF";
        clearInterval(interval);
        interval = setInterval(intervalFunction, 1000/fps);
    };
    var interval = setInterval(intervalFunction, 1000/fps);
</script>
</html>